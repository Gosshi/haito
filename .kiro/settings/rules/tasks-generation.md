# タスク生成ルール

## コア原則

### 1. 自然言語による記述
コード構造ではなく、機能と成果に焦点を当てる。

**記述する**:
- 達成する機能
- ビジネスロジックと動作
- 機能と能力
- ドメイン言語と概念
- データの関係とワークフロー

**避ける**:
- ファイルパスとディレクトリ構造
- 関数/メソッド名とシグネチャ
- 型定義とインターフェース
- クラス名とAPIコントラクト
- 特定のデータ構造

**根拠**: 実装の詳細（ファイル、メソッド、型）はdesign.mdで定義される。タスクは行うべき機能的な作業を記述する。

### 2. タスクの統合と進行

**すべてのタスクは**:
- 以前の出力に基づいて構築する（孤立したコードなし）
- 全体システムに接続する（宙に浮いた機能なし）
- 段階的に進行する（複雑さの大きなジャンプなし）
- シーケンスの早い段階でコア機能を検証する
- design.md（アーキテクチャパターンと境界マップ）で定義されたアーキテクチャ境界を尊重する
- design.mdに文書化されたインターフェースコントラクトを遵守する
- メジャータスクのサマリーは控えめに使用する—作業が子タスクで完全にキャプチャされている場合は詳細な箇条書きを省略する

**最後に統合タスクで**すべてをまとめる。

### 3. 柔軟なタスクサイズ

**ガイドライン**:
- **メジャータスク**: 論理的に必要な数のサブタスク（凝集性でグループ化）
- **サブタスク**: 各1〜3時間、サブタスクあたり3〜10の詳細
- 細かすぎると広すぎるの間のバランス

**任意の数を強制しない** - 論理的なグループ化が構造を決定する。

### 4. 要件マッピング

**各タスク詳細セクションの最後に**:
- `_Requirements: X.X, Y.Y_`で**数値要件IDのみ**をリスト（カンマ区切り）。説明テキスト、括弧、翻訳、または自由形式のラベルを追加しない
- 横断的な要件については、すべての関連する要件IDをリストする。すべての要件にはrequirements.mdに数値IDが必要。IDがない場合は、タスク生成前にrequirements.mdを停止して修正する
- 役立つ場合はdesign.mdのコンポーネント/インターフェースを参照する（例: `_Contracts: AuthService API`）

### 5. コードのみにフォーカス

**含める**:
- コーディングタスク（実装）
- テストタスク（ユニット、統合、E2E）
- 技術セットアップタスク（インフラ、設定）

**除外**:
- デプロイメントタスク
- ドキュメントタスク
- ユーザーテスト
- マーケティング/ビジネス活動

### オプションのテストカバレッジタスク

- 設計が既に機能カバレッジを保証しており、迅速なMVPデリバリーが優先される場合、純粋にテスト指向のフォローアップ作業（例: ベースラインレンダリング/ユニットテスト）を`- [ ]*`チェックボックス形式で**オプション**としてマークする
- オプションマーカーは、サブタスクがその詳細箇条書きでrequirements.mdの受け入れ基準を直接参照する場合にのみ適用する
- 実装作業や統合に重要な検証をオプションとしてマークしない—`*`はMVP後に再検討できる補助的/延期可能なテストカバレッジに限定する

## タスク階層ルール

### 最大2レベル
- **レベル1**: メジャータスク（1, 2, 3, 4...）
- **レベル2**: サブタスク（1.1, 1.2, 2.1, 2.2...）
- **より深いネストなし**（1.1.1なし）
- メジャータスクが単一のアクションアイテムのみを含む場合、構造を折りたたみ、サブタスクをメジャーレベルに昇格させる（例: `1.1`を`1.`に置き換える）
- メジャータスクが純粋にコンテナとして存在する場合、チェックボックスの説明を簡潔に保ち、詳細な箇条書きを重複させない—詳細はサブタスクに限定する

### 連番
- メジャータスクは増分する必要がある: 1, 2, 3, 4, 5...
- サブタスクはメジャータスクごとにリセット: 1.1, 1.2、次に2.1, 2.2...
- メジャータスク番号を繰り返さない

### 並列分析（デフォルト）
- 明示的に無効化されない限り（例: `--sequential`フラグ）、並列分析が有効であると仮定する
- **すべての**条件が満たされる場合に並行して実行できるタスクを特定する:
  - 他の保留中のタスクへのデータ依存関係がない
  - 共有ファイルまたはリソースの競合がない
  - 別のタスクからの前提条件のレビュー/承認が不要
- 特定された並列タスクがアーキテクチャパターンと境界マップで定義された別々の境界内で動作することを検証する
- design.mdのAPI/イベントコントラクトが競合を引き起こすような重複がないことを確認する
- 各並列可能タスクのタスク番号の直後に`(P)`を追加する:
  - 例: `- [ ] 2.1 (P) バックグラウンドワーカーを構築する`
  - メジャータスクとサブタスクの両方に適切に適用する
- シーケンシャルモードが要求された場合、`(P)`マーカーを完全に省略する
- 並列タスクを論理的にグループ化し（可能な場合は同じ親）、詳細箇条書きで順序の注意事項を強調する
- タスクが類似して見えても`(P)`を妨げる依存関係を明示的に指摘する

### チェックボックス形式
```markdown
- [ ] 1. メジャータスクの説明
- [ ] 1.1 サブタスクの説明
  - 詳細項目1
  - 詳細項目2
  - _Requirements: X.X_

- [ ] 1.2 サブタスクの説明
  - 詳細項目...
  - _Requirements: Y.Y_

- [ ] 1.3 サブタスクの説明
  - 詳細項目...
  - _Requirements: Z.Z, W.W_

- [ ] 2. 次のメジャータスク（再び1ではない！）
- [ ] 2.1 サブタスク...
```

## 要件カバレッジ

**必須チェック**:
- requirements.mdのすべての要件がカバーされている必要がある
- すべての要件IDをタスクマッピングと相互参照する
- ギャップが見つかった場合: 要件または設計フェーズに戻る
- 対応するタスクなしに要件を残さない

requirements.mdのトップレベル要件番号（例: 要件1 → 1.1, 1.2; 要件2 → 2.1, 2.2）をNとし、その要件グループ内のローカルインデックスをMとする`N.M`形式の数値要件IDを使用する。

意図的に延期した要件は根拠とともに文書化する。
