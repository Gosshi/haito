# セキュリティ標準

[目的: 検証、認可、シークレット、データのパターンでセキュリティ姿勢を定義]

## 哲学
- 多層防御; 最小権限; デフォルトでセキュア; 失敗時は閉じる
- 境界で検証; コンテキストに応じてサニタイズ; 入力を決して信頼しない
- 認証（誰か）と認可（何ができるか）を分離

## 入力と出力
- API境界とUIフォームで検証; 型と制約を強制
- 宛先に基づいてサニタイズ/エスケープ（HTML、SQL、シェル、ログ）
- ブロックリストよりホワイトリストを優先; 最小限の詳細で早期拒否

## 認証と認可
- 認証: 身元を確認; 短命トークン/セッションを発行
- 認可: アクション前に権限をチェック; デフォルトで拒否
- ポリシーを中央集権化; コード全体でチェックを重複させない

パターン:
```typescript
if (!user.hasPermission('resource:action')) throw ForbiddenError();
```

## シークレットと設定
- シークレットをコミットしない; シークレットマネージャーまたはenvに保存
- 定期的にローテーション; アクセスを監査; 最小限にスコープ
- スタートアップ時に必要な環境変数を検証; 欠落で早期失敗

## 機密データ
- 収集を最小化; ログでマスク/編集; 保存時と転送時に暗号化
- ロール/知る必要性でアクセスを制限; 機密レコードへのアクセスを追跡

## セッション/トークンセキュリティ
- 可能な場合はhttpOnly + secureクッキー; 全面的にTLS
- 短い有効期限; リフレッシュ時にローテーション; ログアウト/侵害時に失効
- トークンをaudience/issuerにバインド; 最小限のクレームを含む

## ロギング（セキュリティ考慮）
- 認証試行、権限拒否、機密操作をログ
- パスワード、トークン、シークレット、完全なPIIをログしない; 完全なボディを避ける
- イベントを関連付けるためにrequestIdとコンテキストを含む

## ヘッダーとトランスポート
- TLSを強制; HSTS
- セキュリティヘッダーを設定（CSP、X-Frame-Options、X-Content-Type-Options）
- 現代の暗号を優先; 弱いプロトコル/暗号を無効化

## 脆弱性姿勢
- セキュアなライブラリを優先; 依存関係を更新
- CIで静的/動的スキャン; 追跡と修正
- 一般的なクラスについてチームを教育; 上記のパターンとしてエンコード

---
_パターンと原則に焦点を当てる。具体的な設定は運用ドキュメントにリンク。_
