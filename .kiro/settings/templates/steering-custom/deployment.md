# デプロイメント標準

[目的: 明確な環境とパイプラインパターンによる安全で再現可能なリリース]

## 哲学
- 自動化; デプロイ前にテスト; デプロイ後に検証
- 迅速なロールバックを伴う段階的ロールアウトを優先
- 本番環境の変更は観測可能で可逆的でなければならない

## 環境
- Dev: 高速イテレーション; デバッグ有効
- Staging: 本番をミラー; リリース検証
- Prod: 堅牢化; 監視; 最小権限

## CI/CDフロー
```
コード → テスト → ビルド → スキャン → デプロイ（段階的）→ 検証
```
原則:
- テスト/スキャンで早期失敗; デプロイをブロック
- アーティファクトビルドは再現可能（lockfile、固定バージョン）
- 本番には手動承認; 監査証跡

## デプロイメント戦略
- ローリング: 段階的なインスタンス置換
- ブルーグリーン: 2つのプール間でトラフィックを切り替え
- カナリー: まず小%のユーザー、ヘルスに応じて拡大
リスクプロファイルに応じて選択; デフォルトを文書化。

## ゼロダウンタイムとマイグレーション
- ヘルスチェックがトラフィックをゲート; グレースフルシャットダウン
- ロールアウト中は後方互換性のあるDB変更
- マイグレーションステップを分離; ロールバックパスをテスト

## ロールバック
- 前バージョンを準備; リバートを自動化
- 修正前進よりロールバックを速く; トリガーを文書化

## 設定とシークレット
- 12-factor設定をenv経由; シークレットをコミットしない
- シークレットマネージャー; ローテーション; 最小権限; アクセス監査
- スタートアップ時に必要な環境変数を検証

## ヘルスとモニタリング
- エンドポイント: `/health`, `/health/live`, `/health/ready`
- レイテンシ、エラーレート、スループット、飽和度を監視
- SLO違反/スパイクでアラート; 疲労を避けるためにチューニング

## インシデント対応とDR
- 標準プレイブック: 検出 → 評価 → 軽減 → コミュニケーション → 解決 → ポストモーテム
- 保持付きバックアップ; リストアをテスト; 定義されたRPO/RTO

---
_ロールアウトパターンとセーフガードに焦点を当てる。プロバイダー固有の手順なし。_
