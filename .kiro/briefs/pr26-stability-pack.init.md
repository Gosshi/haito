対象PRの brief を .kiro/briefs/ に作成済み。
brief の「技術固定」「禁止事項」「AC」を最優先して、要件→設計→タスクを生成して。
スコープ外の提案やファイル追加はしない。必要なら質問は最大3つまで。

# 共通ルール（全PR）
- 既存の仕様・データ・UIを勝手に拡張しない（このPRのIn scopeのみ）。
- 変更理由が「好み」「一般論」のものは禁止。briefに根拠がある変更のみ。
- 既存のスタイル/命名/ディレクトリ構造に合わせる。
- 投資助言につながる表現は禁止（「おすすめ銘柄」「買うべき」「必ず儲かる」等）。
- 「予測」ではなく「試算」「前提条件」を用いる。


# PR#26: Stability Pack（品質安定化）

## 目的
- PR25までに実装されたシミュレーション（通常/ショック/再投資/税区分）の品質を安定化し、外部ユーザーに耐える状態にする。
- 例外・不正値・境界値で落ちない／不自然な数値を出さないことを最優先とする。

## スコープ
### In scope
- API（/api/simulations/dividend-goal, /api/simulations/dividend-goal/shock）の堅牢化
  - 数値の境界値（0, 極端に大きい値, horizon上限）での挙動を明確化し、Zodの制約・エラーメッセージを整理
  - NaN/Infinity/負値の混入防止（計算前後でガード）
  - 400/401/403/500 のレスポンス整合（既存エラーJSON形式の維持）
- シミュレーション計算の丸め/単位の統一
  - 金額は整数円、率は小数（表示は%）など、既存UIに合わせる
- 回帰テスト（最低限）
  - libの計算関数を単体テスト、API route を簡易テスト（既存のテスト基盤に合わせる）

### Out of scope
- 新機能追加（UI項目追加、シナリオ追加、モデル変更）
- DB保存や分析基盤の導入

## 技術固定（変更禁止）
- ZodスキーマSSOT、エラーJSON形式は維持
- shockは永続仕様のまま（回復補正禁止）
- Free/Proの丸め仕様は維持（403で弾かない）
- 既存の画面文言を勝手に変えない（必要なら最小限）

## 受け入れ条件（AC）
- [ ] 極端な入力でもAPIが500にならず、400で落ちる（詳細がある）
- [ ] 計算結果に NaN/Infinity が出ない（0件でも良いが明示）
- [ ] horizon_years の上限/下限が統一される（routeとtypesで一致）
- [ ] 主要ケースで回帰テストが通る（base, shock, taxable, reinvest_rate=0/1）

## 質問（最大3つ）
- なし
