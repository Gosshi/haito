# PR#5: 銘柄編集・削除機能

## 参照ドキュメント
- docs/product.md「F2: 銘柄登録・編集・削除」節
- docs/product.md「データベーススキーマ」節（holdings テーブル）

## 目的
登録済みの保有銘柄を編集・削除できるようにする。ユーザーが保有株数や取得単価を更新したり、不要な銘柄を削除できる。

## 範囲

### In scope
- 銘柄一覧に「編集」「削除」ボタンを追加
- 編集モーダル（Dialog）
  - 編集可能項目: 保有株数、取得単価、口座種別
  - 銘柄コードは編集不可（表示のみ）
  - バリデーション（PR#4と同様）
  - 保存ボタン、キャンセルボタン
- 削除確認ダイアログ（AlertDialog）
  - 「本当に削除しますか？」確認メッセージ
  - 削除ボタン、キャンセルボタン
- Zustand store の UPDATE/DELETE アクション追加
- Supabase との連携（holdings テーブルへの UPDATE/DELETE）
- 楽観的更新（Optimistic Update）の実装
  - UI即時反映 → API成功確認 → エラー時ロールバック

### Out of scope
- 銘柄コードの変更（新規登録→旧削除で対応）
- 一括編集・一括削除
- 編集履歴の保存
- ソフトデリート（物理削除とする）

## 技術固定（変更禁止）
- 編集UI: shadcn/ui の Dialog を使用
- 削除確認UI: shadcn/ui の AlertDialog を使用
- Zustand store を使用（PR#4で作成したものを拡張）
- 楽観的更新パターンを採用

## 受け入れ条件（AC）
- [ ] 銘柄一覧の各行に「編集」「削除」ボタンが表示される
- [ ] 「編集」クリックで編集モーダルが開く
- [ ] 編集モーダルで保有株数・取得単価・口座種別を変更できる
- [ ] 編集保存後、一覧に変更が即時反映される
- [ ] 「削除」クリックで削除確認ダイアログが開く
- [ ] 削除確認後、銘柄が一覧から即時削除される
- [ ] 削除後、ページリロードしても銘柄が復活しない（DB反映確認）
- [ ] API エラー時にロールバックされ、エラーメッセージが表示される
- [ ] 編集・削除操作は本人の銘柄のみ可能（RLSで保護）

## 禁止事項
- holdings テーブルスキーマの変更
- 新しい状態管理ライブラリの導入
- 銘柄コードの編集機能
- 確認なしの即時削除

## 成果物
1. **コード:**
   - `/components/portfolio/edit-holding-dialog.tsx`
   - `/components/portfolio/delete-holding-dialog.tsx`
   - `/components/portfolio/holdings-table.tsx`（編集・削除ボタン追加）
   - `/stores/holdings-store.ts`（UPDATE/DELETEアクション追加）
   - `/lib/api/holdings.ts`（update, delete 関数追加）
2. **PR要約:** 機能説明、楽観的更新の動作説明

## 質問（最大3つ）
1. 編集時に口座種別を変更した場合、UNIQUE制約違反の可能性があるがエラー表示で良いか？
2. 削除時の確認メッセージは「{銘柄名}を削除しますか？」の形式で良いか？
3. 楽観的更新のエラー時、トースト通知を表示するか？（shadcn/ui の toast を使用）
