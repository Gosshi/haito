---
description: .kiro/steering/を永続的なプロジェクト知識として管理する
allowed-tools: Bash, Read, Write, Edit, MultiEdit, Glob, Grep, LS
---

# Kiroステアリング管理

<background_information>
**役割**: `.kiro/steering/`を永続的なプロジェクトメモリとして維持する。

**ミッション**:
- ブートストラップ: コードベースからコアステアリングを生成（初回）
- 同期: ステアリングとコードベースの整合性を維持（メンテナンス）
- 保存: ユーザーカスタマイズは神聖、更新は追加的

**成功基準**:
- ステアリングが網羅的リストではなくパターンと原則をキャプチャ
- コードドリフトを検出して報告
- すべての`.kiro/steering/*.md`を同等に扱う（コア + カスタム）
</background_information>

<instructions>
## シナリオ検出

`.kiro/steering/`のステータスを確認:

**ブートストラップモード**: 空 または コアファイルがない（product.md、tech.md、structure.md）
**同期モード**: すべてのコアファイルが存在

---

## ブートストラップフロー

1. `.kiro/settings/templates/steering/`からテンプレートをロード
2. コードベースを分析（JIT）:
   - ソースファイルに`glob_file_search`
   - README、package.jsonなどに`read_file`
   - パターンに`grep`
3. パターンを抽出（リストではなく）:
   - Product: 目的、価値、コア機能
   - Tech: フレームワーク、決定、規約
   - Structure: 組織、命名、インポート
4. ステアリングファイルを生成（テンプレートに従う）
5. `.kiro/settings/rules/steering-principles.md`から原則をロード
6. レビュー用にサマリーを提示

**フォーカス**: ファイル/依存関係のカタログではなく、決定をガイドするパターン。

---

## 同期フロー

1. すべての既存ステアリングをロード（`.kiro/steering/*.md`）
2. 変更のためにコードベースを分析（JIT）
3. ドリフトを検出:
   - **ステアリング → コード**: 欠落要素 → 警告
   - **コード → ステアリング**: 新しいパターン → 更新候補
   - **カスタムファイル**: 関連性を確認
4. 更新を提案（追加的、ユーザーコンテンツを保存）
5. レポート: 更新、警告、推奨

**更新哲学**: 置き換えではなく追加。ユーザーセクションを保存。

---

## 粒度原則

`.kiro/settings/rules/steering-principles.md`より:

> 「新しいコードが既存のパターンに従う場合、ステアリングの更新は不要」

網羅的リストではなくパターンと原則を文書化。

**悪い例**: ディレクトリツリーにすべてのファイルをリスト
**良い例**: 例を含む組織パターンを説明

</instructions>

## ツールガイダンス

- `glob_file_search`: ソース/設定ファイルを見つける
- `read_file`: ステアリング、ドキュメント、設定を読む
- `grep`: パターンを検索
- `list_dir`: 構造を分析

**JIT戦略**: 事前ではなく必要な時にフェッチ。

## 出力説明

チャットサマリーのみ（ファイルは直接更新）。

### ブートストラップ:
```
✅ ステアリング作成完了

## 生成:
- product.md: [簡単な説明]
- tech.md: [主要スタック]
- structure.md: [組織]

ソースオブトゥルースとして確認・承認してください。
```

### 同期:
```
✅ ステアリング更新完了

## 変更:
- tech.md: React 18 → 19
- structure.md: APIパターンを追加

## コードドリフト:
- コンポーネントがインポート規約に従っていない

## 推奨:
- api-standards.mdの検討
```

## 例

### ブートストラップ
**入力**: 空のステアリング、React TypeScriptプロジェクト
**出力**: パターンを含む3ファイル - 「機能優先」、「TypeScript strict」、「React 19」

### 同期
**入力**: 既存のステアリング、新しい`/api`ディレクトリ
**出力**: structure.md更新、非準拠ファイルをフラグ、api-standards.mdを提案

## セーフティ＆フォールバック

- **セキュリティ**: キー、パスワード、シークレットを含めない（原則参照）
- **不確実性**: 両方の状態を報告、ユーザーに確認
- **保存**: 迷った場合は置き換えより追加

## 注記

- すべての`.kiro/steering/*.md`がプロジェクトメモリとしてロードされる
- テンプレートと原則はカスタマイズ用に外部化
- カタログではなくパターンに集中
- 「ゴールデンルール」: パターンに従う新しいコードはステアリング更新を必要としない
- エージェント固有のツールディレクトリ（例: `.cursor/`、`.gemini/`、`.claude/`）の文書化は避ける
- `.kiro/settings/`の内容はステアリングファイルに文書化すべきではない（settingsはメタデータ、プロジェクト知識ではない）
- `.kiro/specs/`と`.kiro/steering/`への軽い参照は許容; 他の`.kiro/`ディレクトリは避ける
