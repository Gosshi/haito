---
description: 要件と既存コードベース間の実装ギャップを分析する
allowed-tools: Bash, Glob, Grep, Read, Write, Edit, MultiEdit, WebSearch, WebFetch
argument-hint: <feature-name>
---

# 実装ギャップ検証

<background_information>
- **ミッション**: 実装戦略に情報を提供するために、要件と既存コードベース間のギャップを分析する
- **成功基準**:
  - 既存コードベースのパターンとコンポーネントの包括的な理解
  - 欠落機能と統合課題の明確な特定
  - 複数の実行可能な実装アプローチの評価
  - 設計フェーズの技術調査ニーズの特定
</background_information>

<instructions>
## コアタスク
承認された要件と既存コードベースに基づいて機能 **$1** の実装ギャップを分析する。

## 実行ステップ

1. **コンテキストのロード**:
   - 言語とメタデータのために`.kiro/specs/$1/spec.json`を読む
   - 要件のために`.kiro/specs/$1/requirements.md`を読む
   - **すべてのステアリングコンテキストをロード**: 以下を含む`.kiro/steering/`ディレクトリ全体を読む:
     - デフォルトファイル: `structure.md`、`tech.md`、`product.md`
     - すべてのカスタムステアリングファイル（モード設定に関係なく）
     - これにより完全なプロジェクトメモリとコンテキストが提供される

2. **分析ガイドラインを読む**:
   - 包括的な分析フレームワークのために`.kiro/settings/rules/gap-analysis.md`を読む

3. **ギャップ分析を実行**:
   - 徹底的な調査のためにgap-analysis.mdフレームワークに従う
   - GrepとReadツールを使用して既存コードベースを分析
   - 必要に応じて外部依存関係調査のためにWebSearch/WebFetchを使用
   - 複数の実装アプローチを評価（拡張/新規/ハイブリッド）
   - 出力にはspec.jsonで指定された言語を使用

4. **分析ドキュメントを生成**:
   - gap-analysis.mdの出力ガイドラインに従った包括的なギャップ分析を作成
   - トレードオフを伴う複数の実行可能なオプションを提示
   - さらなる調査が必要な領域をフラグ

## 重要な制約
- **決定より情報**: 最終的な実装選択ではなく、分析とオプションを提供
- **複数オプション**: 該当する場合は実行可能な代替案を提示
- **徹底的な調査**: ツールを使用して既存コードベースを深く理解
- **明示的なギャップ**: 調査や調査が必要な領域を明確にフラグ
</instructions>

## ツールガイダンス
- **最初に読む**: 分析前にすべてのコンテキストをロード（spec、steering、rules）
- **広範にGrep**: パターン、規約、統合ポイントのためにコードベースを検索
- **WebSearch/WebFetch**: 必要に応じて外部依存関係とベストプラクティスを調査
- **最後に書く**: 完全な調査後にのみ分析を生成

## 出力説明
spec.jsonで指定された言語で出力を提供:

1. **分析サマリー**: スコープ、課題、推奨の簡潔な概要（3〜5箇条書き）
2. **ドキュメントステータス**: 使用した分析アプローチを確認
3. **次のステップ**: 設計フェーズへの進み方をユーザーにガイド

**フォーマット要件**:
- 明確にするためにMarkdown見出しを使用
- サマリーを簡潔に保つ（300語以下）
- 詳細な分析はgap-analysis.mdの出力ガイドラインに従う

## セーフティ＆フォールバック

### エラーシナリオ
- **要件がない**: requirements.mdが存在しない場合、メッセージで停止: 「最初に`/kiro:spec-requirements $1`を実行して要件を生成してください」
- **要件が承認されていない**: 要件が承認されていない場合、ユーザーに警告するが続行（ギャップ分析は要件の修正に情報を提供できる）
- **空のステアリングディレクトリ**: プロジェクトコンテキストがないことを警告し、分析品質に影響する可能性があることを伝える
- **複雑な統合が不明**: ブロックするのではなく、設計フェーズでの包括的調査のためにフラグ
- **言語が未定義**: spec.jsonで言語が指定されていない場合、英語（`en`）にデフォルト

### 次フェーズ: 設計生成

**ギャップ分析完了の場合**:
- ギャップ分析の洞察を確認
- 技術設計ドキュメントを作成するために`/kiro:spec-design $1`を実行
- または要件を自動承認して直接進むために`/kiro:spec-design $1 -y`

**注記**: ギャップ分析はオプションだが、設計決定に情報を提供するためにブラウンフィールドプロジェクトに推奨。
